{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "from time import time\n",
    "import numpy as np"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "from IPython.core.interactiveshell import InteractiveShell\n",
    "InteractiveShell.ast_node_interactivity = 'all'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
<<<<<<< HEAD
      "Today is 19/04/2021. Retrieve data from how many days? 0\n",
=======
      "Today is 20/04/2021. Retrieve data from how many days? \n",
>>>>>>> model_hosp_dep
      "Ok, will retrieve data from 19/04/2021\n"
     ]
    }
   ],
   "source": [
    "import my_package.v4_dicts as dc\n",
    "import my_package.v4_datepaths as dp\n",
    "import my_package.v4_calculus as cc"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "https://www.data.gouv.fr/fr/datasets/donnees-relatives-aux-resultats-des-tests-virologiques-covid-19/\n",
    "\n",
    "https://www.data.gouv.fr/fr/datasets/donnees-hospitalieres-relatives-a-lepidemie-de-covid-19/\n",
    "\n",
    "https://www.data.gouv.fr/fr/datasets/donnees-relatives-aux-personnes-vaccinees-contre-la-covid-19-1/"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Données relatives aux résultats des tests virologiques"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "tic = time()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "../Data/sp-pos-quot-dep-2021-04-19-19h06.csv\n",
      "./Temp/v4/sp-pos-quot-dep-2021-04-19-19h06-tot-3C-compute.csv\n"
     ]
    }
   ],
   "source": [
    "d_tests_1, path_temp = cc.sp_input()\n",
    "d_tests_2 = cc.sp_tot_3C(d_tests_1)\n",
    "d_tests_3 = cc.sp_compute(d_tests_2)\n",
    "\n",
    "dout = d_tests_3\n",
    "fname = path_temp + '-tot-3C-compute.csv'\n",
    "dout.to_csv(fname, sep = ';', index = False)\n",
    "print(fname)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>dep</th>\n",
       "      <th>jour</th>\n",
       "      <th>P</th>\n",
       "      <th>T</th>\n",
       "      <th>cl_age90</th>\n",
       "      <th>pop</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
<<<<<<< HEAD
       "      <th>264578</th>\n",
       "      <td>70</td>\n",
       "      <td>2021-03-31</td>\n",
       "      <td>9</td>\n",
       "      <td>138</td>\n",
       "      <td>69</td>\n",
       "      <td>32926.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>58261</th>\n",
       "      <td>16</td>\n",
       "      <td>2020-12-10</td>\n",
       "      <td>12</td>\n",
       "      <td>160</td>\n",
       "      <td>59</td>\n",
       "      <td>48767.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>30090</th>\n",
       "      <td>09</td>\n",
       "      <td>2020-06-05</td>\n",
       "      <td>0</td>\n",
       "      <td>12</td>\n",
       "      <td>59</td>\n",
       "      <td>21635.0</td>\n",
=======
       "      <th>88115</th>\n",
       "      <td>25</td>\n",
       "      <td>2020-12-12</td>\n",
       "      <td>26</td>\n",
       "      <td>240</td>\n",
       "      <td>59</td>\n",
       "      <td>67781.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>149480</th>\n",
       "      <td>40</td>\n",
       "      <td>2020-06-11</td>\n",
       "      <td>0</td>\n",
       "      <td>13</td>\n",
       "      <td>19</td>\n",
       "      <td>45099.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>371876</th>\n",
       "      <td>974</td>\n",
       "      <td>2021-01-13</td>\n",
       "      <td>30</td>\n",
       "      <td>2187</td>\n",
       "      <td>0</td>\n",
       "      <td>859959.0</td>\n",
>>>>>>> model_hosp_dep
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
<<<<<<< HEAD
       "       dep       jour   P    T  cl_age90      pop\n",
       "264578  70 2021-03-31   9  138        69  32926.0\n",
       "58261   16 2020-12-10  12  160        59  48767.0\n",
       "30090   09 2020-06-05   0   12        59  21635.0"
=======
       "        dep       jour   P     T  cl_age90       pop\n",
       "88115    25 2020-12-12  26   240        59   67781.0\n",
       "149480   40 2020-06-11   0    13        19   45099.0\n",
       "371876  974 2021-01-13  30  2187         0  859959.0"
>>>>>>> model_hosp_dep
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "text/plain": [
       "(387816, 6)"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>entity</th>\n",
       "      <th>three_class</th>\n",
       "      <th>jour</th>\n",
       "      <th>P</th>\n",
       "      <th>T</th>\n",
       "      <th>pop</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
<<<<<<< HEAD
       "      <th>29952</th>\n",
       "      <td>24</td>\n",
       "      <td>0-29</td>\n",
       "      <td>2020-06-12</td>\n",
       "      <td>0</td>\n",
       "      <td>31</td>\n",
       "      <td>107442.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>86847</th>\n",
       "      <td>64</td>\n",
       "      <td>whole</td>\n",
       "      <td>2020-05-28</td>\n",
       "      <td>8</td>\n",
       "      <td>507</td>\n",
       "      <td>683169.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>147962</th>\n",
       "      <td>Normandie</td>\n",
       "      <td>60+</td>\n",
       "      <td>2020-06-21</td>\n",
       "      <td>0</td>\n",
       "      <td>208</td>\n",
       "      <td>952156.0</td>\n",
=======
       "      <th>36929</th>\n",
       "      <td>29</td>\n",
       "      <td>30-59</td>\n",
       "      <td>2020-07-31</td>\n",
       "      <td>1</td>\n",
       "      <td>570</td>\n",
       "      <td>337136.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>110656</th>\n",
       "      <td>81</td>\n",
       "      <td>0-29</td>\n",
       "      <td>2020-12-04</td>\n",
       "      <td>13</td>\n",
       "      <td>262</td>\n",
       "      <td>117950.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>133135</th>\n",
       "      <td>973</td>\n",
       "      <td>whole</td>\n",
       "      <td>2020-07-13</td>\n",
       "      <td>135</td>\n",
       "      <td>853</td>\n",
       "      <td>290691.0</td>\n",
>>>>>>> model_hosp_dep
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
<<<<<<< HEAD
       "           entity three_class       jour  P    T       pop\n",
       "29952          24        0-29 2020-06-12  0   31  107442.0\n",
       "86847          64       whole 2020-05-28  8  507  683169.0\n",
       "147962  Normandie         60+ 2020-06-21  0  208  952156.0"
=======
       "       entity three_class       jour    P    T       pop\n",
       "36929      29       30-59 2020-07-31    1  570  337136.0\n",
       "110656     81        0-29 2020-12-04   13  262  117950.0\n",
       "133135    973       whole 2020-07-13  135  853  290691.0"
>>>>>>> model_hosp_dep
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "text/plain": [
       "(157296, 6)"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>entity</th>\n",
       "      <th>three_class</th>\n",
       "      <th>jour</th>\n",
       "      <th>P</th>\n",
       "      <th>T</th>\n",
       "      <th>pop</th>\n",
       "      <th>P hebdo</th>\n",
       "      <th>T hebdo</th>\n",
       "      <th>incidence hebdo</th>\n",
       "      <th>taux de positifs hebdo</th>\n",
       "      <th>taux de tests hebdo</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
<<<<<<< HEAD
       "      <th>111522</th>\n",
       "      <td>82</td>\n",
       "      <td>60+</td>\n",
       "      <td>2020-08-03</td>\n",
       "      <td>0</td>\n",
       "      <td>90</td>\n",
       "      <td>75682.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>475.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>627.626120</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21445</th>\n",
       "      <td>16</td>\n",
       "      <td>30-59</td>\n",
       "      <td>2021-02-13</td>\n",
       "      <td>8</td>\n",
       "      <td>247</td>\n",
       "      <td>128407.0</td>\n",
       "      <td>140.0</td>\n",
       "      <td>3151.0</td>\n",
       "      <td>109.028324</td>\n",
       "      <td>4.443034</td>\n",
       "      <td>2453.916064</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15538</th>\n",
       "      <td>12</td>\n",
       "      <td>60+</td>\n",
       "      <td>2020-10-15</td>\n",
       "      <td>45</td>\n",
       "      <td>292</td>\n",
       "      <td>98333.0</td>\n",
       "      <td>276.0</td>\n",
       "      <td>2311.0</td>\n",
       "      <td>280.678918</td>\n",
       "      <td>11.942882</td>\n",
       "      <td>2350.177458</td>\n",
=======
       "      <th>45254</th>\n",
       "      <td>33</td>\n",
       "      <td>60+</td>\n",
       "      <td>2020-09-16</td>\n",
       "      <td>72</td>\n",
       "      <td>907</td>\n",
       "      <td>412676.0</td>\n",
       "      <td>339.0</td>\n",
       "      <td>5654.0</td>\n",
       "      <td>82.146769</td>\n",
       "      <td>5.995755</td>\n",
       "      <td>1370.082098</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21852</th>\n",
       "      <td>17</td>\n",
       "      <td>0-29</td>\n",
       "      <td>2020-06-21</td>\n",
       "      <td>0</td>\n",
       "      <td>9</td>\n",
       "      <td>183823.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>161.0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>87.584252</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4018</th>\n",
       "      <td>03</td>\n",
       "      <td>60+</td>\n",
       "      <td>2021-04-04</td>\n",
       "      <td>3</td>\n",
       "      <td>71</td>\n",
       "      <td>117862.0</td>\n",
       "      <td>181.0</td>\n",
       "      <td>2842.0</td>\n",
       "      <td>153.569429</td>\n",
       "      <td>6.368754</td>\n",
       "      <td>2411.294565</td>\n",
>>>>>>> model_hosp_dep
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
<<<<<<< HEAD
       "       entity three_class       jour   P    T       pop  P hebdo  T hebdo  \\\n",
       "111522     82         60+ 2020-08-03   0   90   75682.0      0.0    475.0   \n",
       "21445      16       30-59 2021-02-13   8  247  128407.0    140.0   3151.0   \n",
       "15538      12         60+ 2020-10-15  45  292   98333.0    276.0   2311.0   \n",
       "\n",
       "        incidence hebdo  taux de positifs hebdo  taux de tests hebdo  \n",
       "111522         0.000000                0.000000           627.626120  \n",
       "21445        109.028324                4.443034          2453.916064  \n",
       "15538        280.678918               11.942882          2350.177458  "
=======
       "      entity three_class       jour   P    T       pop  P hebdo  T hebdo  \\\n",
       "45254     33         60+ 2020-09-16  72  907  412676.0    339.0   5654.0   \n",
       "21852     17        0-29 2020-06-21   0    9  183823.0      0.0    161.0   \n",
       "4018      03         60+ 2021-04-04   3   71  117862.0    181.0   2842.0   \n",
       "\n",
       "       incidence hebdo  taux de positifs hebdo  taux de tests hebdo  \n",
       "45254        82.146769                5.995755          1370.082098  \n",
       "21852         0.000000                0.000000            87.584252  \n",
       "4018        153.569429                6.368754          2411.294565  "
>>>>>>> model_hosp_dep
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "text/plain": [
       "(157296, 11)"
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#\n",
    "d_tests_1.sample(3)\n",
    "d_tests_1.shape\n",
    "#\n",
    "d_tests_2.sample(3)\n",
    "d_tests_2.shape\n",
    "#\n",
    "d_tests_3.sample(3)\n",
    "d_tests_3.shape"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Données hospitalières (1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "../Data/donnees-hospitalieres-classe-age-covid19-2021-04-19-19h12.csv\n",
      "./Temp/v4/donnees-hospitalieres-classe-age-covid19-2021-04-19-19h12-3C-compute.csv\n"
     ]
    }
   ],
   "source": [
    "d_hosp_1, path_temp = cc.hosp_input()\n",
    "d_hosp_2 = cc.hosp_3C(d_hosp_1)\n",
    "d_hosp_3 = cc.hosp_compute(d_hosp_2)\n",
    "\n",
    "dout = d_hosp_3\n",
    "fname = path_temp + '-3C-compute.csv'\n",
    "dout.to_csv(fname, sep = ';', index = False)\n",
    "print(fname)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "'d_hosp_1: '"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "text/plain": [
       "(78804, 10)"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>jour</th>\n",
       "      <th>hosp</th>\n",
       "      <th>rea</th>\n",
       "      <th>HospConv</th>\n",
       "      <th>SSR_USLD</th>\n",
       "      <th>autres</th>\n",
       "      <th>rad</th>\n",
       "      <th>dc</th>\n",
       "      <th>entity</th>\n",
       "      <th>three_class</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
<<<<<<< HEAD
       "      <th>58951</th>\n",
       "      <td>2021-01-09</td>\n",
       "      <td>3</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>77</td>\n",
       "      <td>0</td>\n",
       "      <td>Nouvelle-Aquitaine</td>\n",
       "      <td>0-29</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>28334</th>\n",
       "      <td>2020-08-08</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>7</td>\n",
       "      <td>5</td>\n",
       "      <td>Outre-mer (DROM)</td>\n",
       "      <td>60+</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>53096</th>\n",
       "      <td>2020-12-11</td>\n",
=======
       "      <th>18368</th>\n",
       "      <td>2020-06-18</td>\n",
       "      <td>36</td>\n",
       "      <td>2</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>428</td>\n",
       "      <td>156</td>\n",
       "      <td>Nouvelle-Aquitaine</td>\n",
       "      <td>60+</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>74808</th>\n",
       "      <td>2021-03-30</td>\n",
       "      <td>420</td>\n",
       "      <td>104</td>\n",
       "      <td>207.0</td>\n",
       "      <td>108.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>3444</td>\n",
       "      <td>747</td>\n",
       "      <td>Occitanie</td>\n",
       "      <td>60+</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>39129</th>\n",
       "      <td>2020-10-01</td>\n",
>>>>>>> model_hosp_dep
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
<<<<<<< HEAD
       "      <td>7</td>\n",
       "      <td>1</td>\n",
       "      <td>Outre-mer (DROM)</td>\n",
       "      <td>60+</td>\n",
=======
       "      <td>24</td>\n",
       "      <td>0</td>\n",
       "      <td>Pays de la Loire</td>\n",
       "      <td>0-29</td>\n",
>>>>>>> model_hosp_dep
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
<<<<<<< HEAD
       "            jour  hosp  rea  HospConv  SSR_USLD  autres  rad  dc  \\\n",
       "58951 2021-01-09     3    1       NaN       NaN     NaN   77   0   \n",
       "28334 2020-08-08     0    0       NaN       NaN     NaN    7   5   \n",
       "53096 2020-12-11     0    0       NaN       NaN     NaN    7   1   \n",
       "\n",
       "                   entity three_class  \n",
       "58951  Nouvelle-Aquitaine        0-29  \n",
       "28334    Outre-mer (DROM)         60+  \n",
       "53096    Outre-mer (DROM)         60+  "
=======
       "            jour  hosp  rea  HospConv  SSR_USLD  autres   rad   dc  \\\n",
       "18368 2020-06-18    36    2       NaN       NaN     NaN   428  156   \n",
       "74808 2021-03-30   420  104     207.0     108.0     1.0  3444  747   \n",
       "39129 2020-10-01     0    0       NaN       NaN     NaN    24    0   \n",
       "\n",
       "                   entity three_class  \n",
       "18368  Nouvelle-Aquitaine         60+  \n",
       "74808           Occitanie         60+  \n",
       "39129    Pays de la Loire        0-29  "
>>>>>>> model_hosp_dep
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "text/plain": [
       "'d_hosp_2: '"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "text/plain": [
       "(23880, 6)"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>entity</th>\n",
       "      <th>three_class</th>\n",
       "      <th>jour</th>\n",
       "      <th>hosp</th>\n",
       "      <th>rea</th>\n",
       "      <th>dc</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
<<<<<<< HEAD
       "      <th>7522</th>\n",
       "      <td>Corse</td>\n",
       "      <td>60+</td>\n",
       "      <td>2020-12-31</td>\n",
       "      <td>14</td>\n",
       "      <td>4</td>\n",
       "      <td>107</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4494</th>\n",
       "      <td>Bretagne</td>\n",
       "      <td>60+</td>\n",
       "      <td>2021-02-08</td>\n",
       "      <td>660</td>\n",
       "      <td>38</td>\n",
       "      <td>958</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11957</th>\n",
       "      <td>Normandie</td>\n",
       "      <td>30-59</td>\n",
       "      <td>2020-10-07</td>\n",
       "      <td>38</td>\n",
       "      <td>9</td>\n",
       "      <td>33</td>\n",
=======
       "      <th>14364</th>\n",
       "      <td>Occitanie</td>\n",
       "      <td>0-29</td>\n",
       "      <td>2020-03-27</td>\n",
       "      <td>20</td>\n",
       "      <td>4</td>\n",
       "      <td>1</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19627</th>\n",
       "      <td>Provence-Alpes-Côte d'Azur</td>\n",
       "      <td>whole</td>\n",
       "      <td>2020-07-26</td>\n",
       "      <td>387</td>\n",
       "      <td>15</td>\n",
       "      <td>961</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1011</th>\n",
       "      <td>Auvergne-Rhône-Alpes</td>\n",
       "      <td>whole</td>\n",
       "      <td>2020-11-25</td>\n",
       "      <td>6155</td>\n",
       "      <td>758</td>\n",
       "      <td>4900</td>\n",
>>>>>>> model_hosp_dep
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
<<<<<<< HEAD
       "          entity three_class       jour  hosp  rea   dc\n",
       "7522       Corse         60+ 2020-12-31    14    4  107\n",
       "4494    Bretagne         60+ 2021-02-08   660   38  958\n",
       "11957  Normandie       30-59 2020-10-07    38    9   33"
=======
       "                           entity three_class       jour  hosp  rea    dc\n",
       "14364                   Occitanie        0-29 2020-03-27    20    4     1\n",
       "19627  Provence-Alpes-Côte d'Azur       whole 2020-07-26   387   15   961\n",
       "1011         Auvergne-Rhône-Alpes       whole 2020-11-25  6155  758  4900"
>>>>>>> model_hosp_dep
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "text/plain": [
       "'d_hosp_3: '"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "text/plain": [
       "(23880, 10)"
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>entity</th>\n",
       "      <th>three_class</th>\n",
       "      <th>jour</th>\n",
       "      <th>hosp</th>\n",
       "      <th>rea</th>\n",
       "      <th>dc</th>\n",
       "      <th>dc hebdo</th>\n",
       "      <th>taux hosp</th>\n",
       "      <th>taux rea</th>\n",
       "      <th>taux décès</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
<<<<<<< HEAD
       "      <th>8120</th>\n",
       "      <td>Grand Est</td>\n",
       "      <td>0-29</td>\n",
       "      <td>2020-04-27</td>\n",
       "      <td>71</td>\n",
       "      <td>13</td>\n",
       "      <td>2</td>\n",
       "      <td>0.0</td>\n",
       "      <td>3.787533</td>\n",
       "      <td>0.693492</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1484</th>\n",
       "      <td>Auvergne-Rhône-Alpes</td>\n",
       "      <td>0-29</td>\n",
       "      <td>2021-03-24</td>\n",
       "      <td>47</td>\n",
       "      <td>4</td>\n",
       "      <td>9</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.657748</td>\n",
       "      <td>0.141085</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14889</th>\n",
       "      <td>Occitanie</td>\n",
       "      <td>30-59</td>\n",
       "      <td>2020-08-05</td>\n",
       "      <td>7</td>\n",
       "      <td>2</td>\n",
       "      <td>23</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.315165</td>\n",
       "      <td>0.090047</td>\n",
       "      <td>0.0</td>\n",
=======
       "      <th>11713</th>\n",
       "      <td>Normandie</td>\n",
       "      <td>30-59</td>\n",
       "      <td>2020-08-07</td>\n",
       "      <td>14</td>\n",
       "      <td>3</td>\n",
       "      <td>30</td>\n",
       "      <td>1.0</td>\n",
       "      <td>1.139993</td>\n",
       "      <td>0.244284</td>\n",
       "      <td>0.081428</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20379</th>\n",
       "      <td>Provence-Alpes-Côte d'Azur</td>\n",
       "      <td>whole</td>\n",
       "      <td>2021-01-30</td>\n",
       "      <td>3269</td>\n",
       "      <td>409</td>\n",
       "      <td>4521</td>\n",
       "      <td>280.0</td>\n",
       "      <td>64.660318</td>\n",
       "      <td>8.089957</td>\n",
       "      <td>5.538357</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10968</th>\n",
       "      <td>Hauts-de-France</td>\n",
       "      <td>0-29</td>\n",
       "      <td>2021-03-07</td>\n",
       "      <td>38</td>\n",
       "      <td>8</td>\n",
       "      <td>4</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.714470</td>\n",
       "      <td>0.360941</td>\n",
       "      <td>0.000000</td>\n",
>>>>>>> model_hosp_dep
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
<<<<<<< HEAD
       "                     entity three_class       jour  hosp  rea  dc  dc hebdo  \\\n",
       "8120              Grand Est        0-29 2020-04-27    71   13   2       0.0   \n",
       "1484   Auvergne-Rhône-Alpes        0-29 2021-03-24    47    4   9       0.0   \n",
       "14889             Occitanie       30-59 2020-08-05     7    2  23       0.0   \n",
       "\n",
       "       taux hosp  taux rea  taux décès  \n",
       "8120    3.787533  0.693492         0.0  \n",
       "1484    1.657748  0.141085         0.0  \n",
       "14889   0.315165  0.090047         0.0  "
=======
       "                           entity three_class       jour  hosp  rea    dc  \\\n",
       "11713                   Normandie       30-59 2020-08-07    14    3    30   \n",
       "20379  Provence-Alpes-Côte d'Azur       whole 2021-01-30  3269  409  4521   \n",
       "10968             Hauts-de-France        0-29 2021-03-07    38    8     4   \n",
       "\n",
       "       dc hebdo  taux hosp  taux rea  taux décès  \n",
       "11713       1.0   1.139993  0.244284    0.081428  \n",
       "20379     280.0  64.660318  8.089957    5.538357  \n",
       "10968       0.0   1.714470  0.360941    0.000000  "
>>>>>>> model_hosp_dep
      ]
     },
     "execution_count": 8,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "'d_hosp_1: '\n",
    "d_hosp_1.shape\n",
    "d_hosp_1.sample(3)\n",
    "'d_hosp_2: '\n",
    "d_hosp_2.shape\n",
    "d_hosp_2.sample(3)\n",
    "'d_hosp_3: '\n",
    "d_hosp_3.shape\n",
    "d_hosp_3.sample(3)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Données hospitalières départementales (2) : pas de répartition par classe d'âge !"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "../Data/donnees-hospitalieres-covid19-2021-04-19-19h12.csv\n",
      "./Temp/v4/donnees-hospitalieres-covid19-2021-04-19-19h12-compute.csv\n"
     ]
    }
   ],
   "source": [
    "d_hosp_dep_1, path_temp = cc.hosp_dep_input()\n",
    "d_hosp_dep_2 = cc.hosp_dep_compute(d_hosp_dep_1)\n",
    "\n",
    "dout = d_hosp_dep_2\n",
    "fname = path_temp + '-compute.csv'\n",
    "dout.to_csv(fname, sep = ';', index = False)\n",
    "print(fname)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>dep</th>\n",
       "      <th>sexe</th>\n",
       "      <th>jour</th>\n",
       "      <th>hosp</th>\n",
       "      <th>rea</th>\n",
       "      <th>HospConv</th>\n",
       "      <th>SSR_USLD</th>\n",
       "      <th>autres</th>\n",
       "      <th>rad</th>\n",
       "      <th>dc</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>01</td>\n",
       "      <td>0</td>\n",
       "      <td>2020-03-18</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>01</td>\n",
       "      <td>1</td>\n",
       "      <td>2020-03-18</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>01</td>\n",
       "      <td>2</td>\n",
       "      <td>2020-03-18</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>02</td>\n",
       "      <td>0</td>\n",
       "      <td>2020-03-18</td>\n",
       "      <td>41</td>\n",
       "      <td>10</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>18</td>\n",
       "      <td>11</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>02</td>\n",
       "      <td>1</td>\n",
       "      <td>2020-03-18</td>\n",
       "      <td>19</td>\n",
       "      <td>4</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>11</td>\n",
       "      <td>6</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>120589</th>\n",
       "      <td>974</td>\n",
       "      <td>1</td>\n",
       "      <td>2021-04-19</td>\n",
       "      <td>93</td>\n",
       "      <td>28</td>\n",
       "      <td>50.0</td>\n",
       "      <td>15.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>678</td>\n",
       "      <td>88</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>120590</th>\n",
       "      <td>974</td>\n",
       "      <td>2</td>\n",
       "      <td>2021-04-19</td>\n",
       "      <td>61</td>\n",
       "      <td>15</td>\n",
       "      <td>35.0</td>\n",
       "      <td>11.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>661</td>\n",
       "      <td>62</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>120591</th>\n",
       "      <td>976</td>\n",
       "      <td>0</td>\n",
       "      <td>2021-04-19</td>\n",
       "      <td>15</td>\n",
       "      <td>7</td>\n",
       "      <td>8.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1228</td>\n",
       "      <td>124</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>120592</th>\n",
       "      <td>976</td>\n",
       "      <td>1</td>\n",
       "      <td>2021-04-19</td>\n",
       "      <td>3</td>\n",
       "      <td>1</td>\n",
       "      <td>2.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>560</td>\n",
       "      <td>73</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>120593</th>\n",
       "      <td>976</td>\n",
       "      <td>2</td>\n",
       "      <td>2021-04-19</td>\n",
       "      <td>11</td>\n",
       "      <td>6</td>\n",
       "      <td>5.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>649</td>\n",
       "      <td>50</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>120594 rows × 10 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "        dep  sexe       jour  hosp  rea  HospConv  SSR_USLD  autres   rad   dc\n",
       "0        01     0 2020-03-18     2    0       NaN       NaN     NaN     1    0\n",
       "1        01     1 2020-03-18     1    0       NaN       NaN     NaN     1    0\n",
       "2        01     2 2020-03-18     1    0       NaN       NaN     NaN     0    0\n",
       "3        02     0 2020-03-18    41   10       NaN       NaN     NaN    18   11\n",
       "4        02     1 2020-03-18    19    4       NaN       NaN     NaN    11    6\n",
       "...     ...   ...        ...   ...  ...       ...       ...     ...   ...  ...\n",
       "120589  974     1 2021-04-19    93   28      50.0      15.0     0.0   678   88\n",
       "120590  974     2 2021-04-19    61   15      35.0      11.0     0.0   661   62\n",
       "120591  976     0 2021-04-19    15    7       8.0       0.0     0.0  1228  124\n",
       "120592  976     1 2021-04-19     3    1       2.0       0.0     0.0   560   73\n",
       "120593  976     2 2021-04-19    11    6       5.0       0.0     0.0   649   50\n",
       "\n",
       "[120594 rows x 10 columns]"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "text/plain": [
       "(120594, 10)"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>entity</th>\n",
       "      <th>jour</th>\n",
       "      <th>hosp</th>\n",
       "      <th>rea</th>\n",
       "      <th>HospConv</th>\n",
       "      <th>SSR_USLD</th>\n",
       "      <th>autres</th>\n",
       "      <th>rad</th>\n",
       "      <th>dc</th>\n",
       "      <th>dc hebdo</th>\n",
       "      <th>taux hosp</th>\n",
       "      <th>taux rea</th>\n",
       "      <th>taux décès</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>01</td>\n",
       "      <td>2020-03-18</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.304435</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>01</td>\n",
       "      <td>2020-03-19</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.304435</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>01</td>\n",
       "      <td>2020-03-20</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.304435</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>01</td>\n",
       "      <td>2020-03-21</td>\n",
       "      <td>4</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.608870</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>01</td>\n",
       "      <td>2020-03-22</td>\n",
       "      <td>8</td>\n",
       "      <td>1</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>2</td>\n",
       "      <td>0</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1.217739</td>\n",
       "      <td>0.152217</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>40193</th>\n",
       "      <td>976</td>\n",
       "      <td>2021-04-15</td>\n",
       "      <td>12</td>\n",
       "      <td>6</td>\n",
       "      <td>6.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1228</td>\n",
       "      <td>124</td>\n",
       "      <td>0.0</td>\n",
       "      <td>4.293827</td>\n",
       "      <td>2.146913</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>40194</th>\n",
       "      <td>976</td>\n",
       "      <td>2021-04-16</td>\n",
       "      <td>12</td>\n",
       "      <td>6</td>\n",
       "      <td>6.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1228</td>\n",
       "      <td>124</td>\n",
       "      <td>0.0</td>\n",
       "      <td>4.293827</td>\n",
       "      <td>2.146913</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>40195</th>\n",
       "      <td>976</td>\n",
       "      <td>2021-04-17</td>\n",
       "      <td>14</td>\n",
       "      <td>6</td>\n",
       "      <td>8.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1228</td>\n",
       "      <td>124</td>\n",
       "      <td>0.0</td>\n",
       "      <td>5.009464</td>\n",
       "      <td>2.146913</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>40196</th>\n",
       "      <td>976</td>\n",
       "      <td>2021-04-18</td>\n",
       "      <td>15</td>\n",
       "      <td>7</td>\n",
       "      <td>8.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1228</td>\n",
       "      <td>124</td>\n",
       "      <td>0.0</td>\n",
       "      <td>5.367283</td>\n",
       "      <td>2.504732</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>40197</th>\n",
       "      <td>976</td>\n",
       "      <td>2021-04-19</td>\n",
       "      <td>15</td>\n",
       "      <td>7</td>\n",
       "      <td>8.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1228</td>\n",
       "      <td>124</td>\n",
       "      <td>0.0</td>\n",
       "      <td>5.367283</td>\n",
       "      <td>2.504732</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>40198 rows × 13 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "      entity       jour  hosp  rea  HospConv  SSR_USLD  autres   rad   dc  \\\n",
       "0         01 2020-03-18     2    0       NaN       NaN     NaN     1    0   \n",
       "1         01 2020-03-19     2    0       NaN       NaN     NaN     1    0   \n",
       "2         01 2020-03-20     2    0       NaN       NaN     NaN     1    0   \n",
       "3         01 2020-03-21     4    0       NaN       NaN     NaN     1    0   \n",
       "4         01 2020-03-22     8    1       NaN       NaN     NaN     2    0   \n",
       "...      ...        ...   ...  ...       ...       ...     ...   ...  ...   \n",
       "40193    976 2021-04-15    12    6       6.0       0.0     0.0  1228  124   \n",
       "40194    976 2021-04-16    12    6       6.0       0.0     0.0  1228  124   \n",
       "40195    976 2021-04-17    14    6       8.0       0.0     0.0  1228  124   \n",
       "40196    976 2021-04-18    15    7       8.0       0.0     0.0  1228  124   \n",
       "40197    976 2021-04-19    15    7       8.0       0.0     0.0  1228  124   \n",
       "\n",
       "       dc hebdo  taux hosp  taux rea  taux décès  \n",
       "0           NaN   0.304435  0.000000         NaN  \n",
       "1           NaN   0.304435  0.000000         NaN  \n",
       "2           NaN   0.304435  0.000000         NaN  \n",
       "3           NaN   0.608870  0.000000         NaN  \n",
       "4           NaN   1.217739  0.152217         NaN  \n",
       "...         ...        ...       ...         ...  \n",
       "40193       0.0   4.293827  2.146913         0.0  \n",
       "40194       0.0   4.293827  2.146913         0.0  \n",
       "40195       0.0   5.009464  2.146913         0.0  \n",
       "40196       0.0   5.367283  2.504732         0.0  \n",
       "40197       0.0   5.367283  2.504732         0.0  \n",
       "\n",
       "[40198 rows x 13 columns]"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "text/plain": [
       "(40198, 13)"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "d_hosp_dep_1\n",
    "d_hosp_dep_1.shape\n",
    "d_hosp_dep_2\n",
    "d_hosp_dep_2.shape"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Données relatives aux personnes vaccinées (VACSI) "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "../Data/vacsi-a-dep-2021-04-19-19h05.csv\n",
      "./Temp/v4/vacsi-a-dep-2021-04-19-19h05-tot-3C-compute.csv\n"
     ]
    }
   ],
   "source": [
    "d_vac_1, path_temp = cc.vac_input()\n",
    "d_vac_2 = cc.vac_tot_3C(d_vac_1)\n",
    "d_vac_3 = cc.vac_compute(d_vac_2)\n",
    "\n",
    "dout = d_vac_3\n",
    "fname = path_temp + '-tot-3C-compute.csv'\n",
    "dout.to_csv(fname, sep = ';', index = False)\n",
    "print(fname)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "(131758, 7)\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>dep</th>\n",
       "      <th>clage_vacsi</th>\n",
       "      <th>jour</th>\n",
       "      <th>n_dose1</th>\n",
       "      <th>n_dose2</th>\n",
       "      <th>n_cum_dose1</th>\n",
       "      <th>n_cum_dose2</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
<<<<<<< HEAD
       "      <th>103086</th>\n",
       "      <td>89</td>\n",
       "      <td>39</td>\n",
       "      <td>2021-01-26</td>\n",
       "      <td>11</td>\n",
       "      <td>0</td>\n",
       "      <td>221</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>101770</th>\n",
       "      <td>88</td>\n",
       "      <td>24</td>\n",
       "      <td>2021-03-07</td>\n",
       "      <td>5</td>\n",
       "      <td>0</td>\n",
       "      <td>169</td>\n",
       "      <td>47</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>102608</th>\n",
       "      <td>88</td>\n",
       "      <td>79</td>\n",
       "      <td>2020-12-31</td>\n",
=======
       "      <th>114681</th>\n",
       "      <td>973</td>\n",
       "      <td>59</td>\n",
       "      <td>2021-04-05</td>\n",
       "      <td>29</td>\n",
       "      <td>4</td>\n",
       "      <td>3813</td>\n",
       "      <td>1674</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>124031</th>\n",
       "      <td>36</td>\n",
       "      <td>0</td>\n",
       "      <td>2021-03-07</td>\n",
       "      <td>336</td>\n",
       "      <td>0</td>\n",
       "      <td>18988</td>\n",
       "      <td>12329</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>23391</th>\n",
       "      <td>21</td>\n",
       "      <td>74</td>\n",
       "      <td>2020-12-27</td>\n",
>>>>>>> model_hosp_dep
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
<<<<<<< HEAD
       "       dep  clage_vacsi       jour  n_dose1  n_dose2  n_cum_dose1  n_cum_dose2\n",
       "103086  89           39 2021-01-26       11        0          221            0\n",
       "101770  88           24 2021-03-07        5        0          169           47\n",
       "102608  88           79 2020-12-31        0        0            0            0"
=======
       "        dep  clage_vacsi       jour  n_dose1  n_dose2  n_cum_dose1  \\\n",
       "114681  973           59 2021-04-05       29        4         3813   \n",
       "124031   36            0 2021-03-07      336        0        18988   \n",
       "23391    21           74 2020-12-27        0        0            0   \n",
       "\n",
       "        n_cum_dose2  \n",
       "114681         1674  \n",
       "124031        12329  \n",
       "23391             0  "
>>>>>>> model_hosp_dep
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "print(d_vac_1.shape)\n",
    "d_vac_1.sample(3)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "(52432, 7)\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>entity</th>\n",
       "      <th>three_class</th>\n",
       "      <th>jour</th>\n",
       "      <th>n_dose1</th>\n",
       "      <th>n_dose2</th>\n",
       "      <th>n_cum_dose1</th>\n",
       "      <th>n_cum_dose2</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
<<<<<<< HEAD
       "      <th>30083</th>\n",
       "      <td>66</td>\n",
       "      <td>whole</td>\n",
       "      <td>2021-02-27</td>\n",
       "      <td>362</td>\n",
       "      <td>432</td>\n",
       "      <td>29693</td>\n",
       "      <td>16226</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22919</th>\n",
       "      <td>50</td>\n",
       "      <td>whole</td>\n",
       "      <td>2021-03-16</td>\n",
       "      <td>1335</td>\n",
       "      <td>269</td>\n",
       "      <td>49947</td>\n",
       "      <td>21538</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>50942</th>\n",
       "      <td>Outre-mer (DROM)</td>\n",
       "      <td>60+</td>\n",
       "      <td>2021-03-16</td>\n",
       "      <td>842</td>\n",
       "      <td>692</td>\n",
       "      <td>33693</td>\n",
       "      <td>16291</td>\n",
=======
       "      <th>32090</th>\n",
       "      <td>70</td>\n",
       "      <td>60+</td>\n",
       "      <td>2021-04-18</td>\n",
       "      <td>38</td>\n",
       "      <td>0</td>\n",
       "      <td>36239</td>\n",
       "      <td>14765</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>38886</th>\n",
       "      <td>86</td>\n",
       "      <td>60+</td>\n",
       "      <td>2020-12-30</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>33163</th>\n",
       "      <td>73</td>\n",
       "      <td>whole</td>\n",
       "      <td>2021-02-06</td>\n",
       "      <td>259</td>\n",
       "      <td>1</td>\n",
       "      <td>15201</td>\n",
       "      <td>1618</td>\n",
>>>>>>> model_hosp_dep
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
<<<<<<< HEAD
       "                 entity three_class       jour  n_dose1  n_dose2  n_cum_dose1  \\\n",
       "30083                66       whole 2021-02-27      362      432        29693   \n",
       "22919                50       whole 2021-03-16     1335      269        49947   \n",
       "50942  Outre-mer (DROM)         60+ 2021-03-16      842      692        33693   \n",
       "\n",
       "       n_cum_dose2  \n",
       "30083        16226  \n",
       "22919        21538  \n",
       "50942        16291  "
=======
       "      entity three_class       jour  n_dose1  n_dose2  n_cum_dose1  \\\n",
       "32090     70         60+ 2021-04-18       38        0        36239   \n",
       "38886     86         60+ 2020-12-30        0        0            1   \n",
       "33163     73       whole 2021-02-06      259        1        15201   \n",
       "\n",
       "       n_cum_dose2  \n",
       "32090        14765  \n",
       "38886            0  \n",
       "33163         1618  "
>>>>>>> model_hosp_dep
      ]
     },
     "execution_count": 13,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "print(d_vac_2.shape)\n",
    "d_vac_2.sample(3)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "(52432, 9)\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>entity</th>\n",
       "      <th>three_class</th>\n",
       "      <th>jour</th>\n",
       "      <th>n_dose1</th>\n",
       "      <th>n_dose2</th>\n",
       "      <th>n_cum_dose1</th>\n",
       "      <th>n_cum_dose2</th>\n",
       "      <th>taux dose 1</th>\n",
       "      <th>taux dose 2</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
<<<<<<< HEAD
       "      <th>9761</th>\n",
       "      <td>23</td>\n",
       "      <td>30-59</td>\n",
       "      <td>2021-03-04</td>\n",
       "      <td>41</td>\n",
       "      <td>25</td>\n",
       "      <td>1937</td>\n",
       "      <td>1254</td>\n",
       "      <td>4.711405</td>\n",
       "      <td>3.050130</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>41539</th>\n",
       "      <td>91</td>\n",
       "      <td>whole</td>\n",
       "      <td>2021-04-07</td>\n",
       "      <td>3231</td>\n",
       "      <td>1685</td>\n",
       "      <td>150881</td>\n",
       "      <td>51834</td>\n",
       "      <td>11.435568</td>\n",
       "      <td>3.928601</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>42953</th>\n",
       "      <td>95</td>\n",
       "      <td>30-59</td>\n",
       "      <td>2020-12-30</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
=======
       "      <th>19768</th>\n",
       "      <td>43</td>\n",
       "      <td>0-29</td>\n",
       "      <td>2021-03-20</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>336</td>\n",
       "      <td>172</td>\n",
       "      <td>0.488713</td>\n",
       "      <td>0.250175</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5551</th>\n",
       "      <td>13</td>\n",
       "      <td>whole</td>\n",
       "      <td>2021-01-27</td>\n",
       "      <td>3097</td>\n",
       "      <td>114</td>\n",
       "      <td>40908</td>\n",
       "      <td>229</td>\n",
       "      <td>2.010746</td>\n",
       "      <td>0.011256</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10247</th>\n",
       "      <td>24</td>\n",
       "      <td>whole</td>\n",
       "      <td>2021-03-12</td>\n",
       "      <td>2034</td>\n",
       "      <td>332</td>\n",
       "      <td>32991</td>\n",
       "      <td>15562</td>\n",
       "      <td>8.078248</td>\n",
       "      <td>3.810545</td>\n",
>>>>>>> model_hosp_dep
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "      entity three_class       jour  n_dose1  n_dose2  n_cum_dose1  \\\n",
<<<<<<< HEAD
       "9761      23       30-59 2021-03-04       41       25         1937   \n",
       "41539     91       whole 2021-04-07     3231     1685       150881   \n",
       "42953     95       30-59 2020-12-30        0        0            0   \n",
       "\n",
       "       n_cum_dose2  taux dose 1  taux dose 2  \n",
       "9761          1254     4.711405     3.050130  \n",
       "41539        51834    11.435568     3.928601  \n",
       "42953            0     0.000000     0.000000  "
=======
       "19768     43        0-29 2021-03-20        0        0          336   \n",
       "5551      13       whole 2021-01-27     3097      114        40908   \n",
       "10247     24       whole 2021-03-12     2034      332        32991   \n",
       "\n",
       "       n_cum_dose2  taux dose 1  taux dose 2  \n",
       "19768          172     0.488713     0.250175  \n",
       "5551           229     2.010746     0.011256  \n",
       "10247        15562     8.078248     3.810545  "
>>>>>>> model_hosp_dep
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "print(d_vac_3.shape)\n",
    "d_vac_3.sample(3)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
<<<<<<< HEAD
      "7.862696647644043  s\n"
=======
      "7.960005044937134  s\n"
>>>>>>> model_hosp_dep
     ]
    }
   ],
   "source": [
    "toc = time()\n",
    "print(-tic+toc, ' s')"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Données hospitalières (3) Estimation par classe d'âge et par département"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## dfs pops et pops_prop"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### df dpops"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "./Temp/v4/sp-pos-quot-dep-2021-04-19-19h06-tot-3C-compute.csv\n"
     ]
    }
   ],
   "source": [
    "fname = dp.retrieve_temp('sp-pos-quot-dep', 'tot-3C-compute')\n",
    "dtes = pd.read_csv(fname, sep = ';', \n",
    "                parse_dates = ['jour'],\n",
    "                dtype = {'entity': str},\n",
    "               )"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th>clage</th>\n",
       "      <th>0-29</th>\n",
       "      <th>30-59</th>\n",
       "      <th>60+</th>\n",
       "      <th>whole</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>entity</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "clage  0-29 30-59  60+ whole\n",
       "entity                      \n",
       "17      NaN   NaN  NaN   NaN"
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "columns = pd.Index(dtes.three_class.unique(), name = 'clage')\n",
    "index = pd.Index(dtes.entity.unique(), name = 'entity')\n",
    "dpops = pd.DataFrame(index = index, columns = columns)\n",
    "dpops.sample()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [],
   "source": [
    "for entity in dtes.entity.unique():\n",
    "    for clage in dtes.three_class.unique():\n",
    "        dpops.loc[entity, clage] = dtes[(dtes.entity == entity) & (dtes.three_class == clage) & (dtes.jour == '2021-01-01')][\"pop\"].values[0]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th>clage</th>\n",
       "      <th>0-29</th>\n",
       "      <th>30-59</th>\n",
       "      <th>60+</th>\n",
       "      <th>whole</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>entity</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>109430.0</td>\n",
       "      <td>136313.0</td>\n",
       "      <td>126962.0</td>\n",
       "      <td>372705.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "clage       0-29     30-59       60+     whole\n",
       "entity                                        \n",
       "11      109430.0  136313.0  126962.0  372705.0"
      ]
     },
     "execution_count": 19,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "dpops.sample()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(116, 4)"
      ]
     },
     "execution_count": 20,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "text/plain": [
       "clage\n",
       "0-29     23555651.0\n",
       "30-59    25657812.0\n",
       "60+      17850240.0\n",
       "whole    67063703.0\n",
       "Name: France, dtype: object"
      ]
     },
     "execution_count": 20,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "text/plain": [
       "17850240.0"
      ]
     },
     "execution_count": 20,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "dpops.shape\n",
    "dpops.loc['France', :]\n",
    "dpops.loc['France','60+']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 41,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "./Temp/v4/vacsi-a-dep-2021-04-19-19h05-pops.csv\n"
     ]
    }
   ],
   "source": [
    "dout = dpops\n",
    "fname = path_temp + '-pops.csv'\n",
    "dout.to_csv(fname, sep = ';', index = False)\n",
    "print(fname)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### df dpops_prop"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th>clage</th>\n",
       "      <th>0-29</th>\n",
       "      <th>30-59</th>\n",
       "      <th>60+</th>\n",
       "      <th>whole</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>entity</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>01</th>\n",
       "      <td>0.354913</td>\n",
       "      <td>0.403463</td>\n",
       "      <td>0.241624</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>02</th>\n",
       "      <td>0.344635</td>\n",
       "      <td>0.37594</td>\n",
       "      <td>0.279426</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>03</th>\n",
       "      <td>0.286133</td>\n",
       "      <td>0.358127</td>\n",
       "      <td>0.35574</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>04</th>\n",
       "      <td>0.287838</td>\n",
       "      <td>0.369062</td>\n",
       "      <td>0.343099</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>05</th>\n",
       "      <td>0.296248</td>\n",
       "      <td>0.37973</td>\n",
       "      <td>0.324022</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Occitanie</th>\n",
       "      <td>0.330174</td>\n",
       "      <td>0.374871</td>\n",
       "      <td>0.294955</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Outre-mer (DROM)</th>\n",
       "      <td>0.432203</td>\n",
       "      <td>0.375058</td>\n",
       "      <td>0.192739</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Pays de la Loire</th>\n",
       "      <td>0.350137</td>\n",
       "      <td>0.375243</td>\n",
       "      <td>0.27462</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Provence-Alpes-Côte d'Azur</th>\n",
       "      <td>0.324136</td>\n",
       "      <td>0.377594</td>\n",
       "      <td>0.29827</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>Île-de-France</th>\n",
       "      <td>0.390357</td>\n",
       "      <td>0.404643</td>\n",
       "      <td>0.205</td>\n",
       "      <td>1.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>116 rows × 4 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "clage                           0-29     30-59       60+ whole\n",
       "entity                                                        \n",
       "01                          0.354913  0.403463  0.241624   1.0\n",
       "02                          0.344635   0.37594  0.279426   1.0\n",
       "03                          0.286133  0.358127   0.35574   1.0\n",
       "04                          0.287838  0.369062  0.343099   1.0\n",
       "05                          0.296248   0.37973  0.324022   1.0\n",
       "...                              ...       ...       ...   ...\n",
       "Occitanie                   0.330174  0.374871  0.294955   1.0\n",
       "Outre-mer (DROM)            0.432203  0.375058  0.192739   1.0\n",
       "Pays de la Loire            0.350137  0.375243   0.27462   1.0\n",
       "Provence-Alpes-Côte d'Azur  0.324136  0.377594   0.29827   1.0\n",
       "Île-de-France               0.390357  0.404643     0.205   1.0\n",
       "\n",
       "[116 rows x 4 columns]"
      ]
     },
     "execution_count": 21,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "dpops_prop = dpops.divide(dpops.whole, axis = 'index')\n",
    "dpops_prop"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## taux hosp"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### empty df dhosps"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "./Temp/v4/donnees-hospitalieres-classe-age-covid19-2021-04-19-19h12-3C-compute.csv\n",
      "./Temp/v4/donnees-hospitalieres-covid19-2021-04-19-19h12-compute.csv\n"
     ]
    }
   ],
   "source": [
    "fname = dp.retrieve_temp('donnees-hospitalieres-classe-age-covid19', '3C-compute')\n",
    "dhos = pd.read_csv(fname, sep = ';', \n",
    "                parse_dates = ['jour'],\n",
    "                dtype = {'entity': str},\n",
    "               )\n",
    "fname = dp.retrieve_temp('donnees-hospitalieres-covid19', 'compute')\n",
    "dhosdep = pd.read_csv(fname, sep = ';', \n",
    "                parse_dates = ['jour'],\n",
    "                dtype = {'entity': str},\n",
    "               )"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(398, 464)"
      ]
     },
     "execution_count": 23,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead tr th {\n",
       "        text-align: left;\n",
       "    }\n",
       "\n",
       "    .dataframe thead tr:last-of-type th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr>\n",
       "      <th>entity</th>\n",
       "      <th colspan=\"4\" halign=\"left\">01</th>\n",
       "      <th colspan=\"4\" halign=\"left\">02</th>\n",
       "      <th colspan=\"2\" halign=\"left\">03</th>\n",
       "      <th>...</th>\n",
       "      <th colspan=\"2\" halign=\"left\">Pays de la Loire</th>\n",
       "      <th colspan=\"4\" halign=\"left\">Provence-Alpes-Côte d'Azur</th>\n",
       "      <th colspan=\"4\" halign=\"left\">Île-de-France</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>clage</th>\n",
       "      <th>0-29</th>\n",
       "      <th>30-59</th>\n",
       "      <th>60+</th>\n",
       "      <th>whole</th>\n",
       "      <th>0-29</th>\n",
       "      <th>30-59</th>\n",
       "      <th>60+</th>\n",
       "      <th>whole</th>\n",
       "      <th>0-29</th>\n",
       "      <th>30-59</th>\n",
       "      <th>...</th>\n",
       "      <th>60+</th>\n",
       "      <th>whole</th>\n",
       "      <th>0-29</th>\n",
       "      <th>30-59</th>\n",
       "      <th>60+</th>\n",
       "      <th>whole</th>\n",
       "      <th>0-29</th>\n",
       "      <th>30-59</th>\n",
       "      <th>60+</th>\n",
       "      <th>whole</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>jour</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2021-04-11</th>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>1 rows × 464 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "entity       01                    02                    03        ...  \\\n",
       "clage      0-29 30-59  60+ whole 0-29 30-59  60+ whole 0-29 30-59  ...   \n",
       "jour                                                               ...   \n",
       "2021-04-11  NaN   NaN  NaN   NaN  NaN   NaN  NaN   NaN  NaN   NaN  ...   \n",
       "\n",
       "entity     Pays de la Loire       Provence-Alpes-Côte d'Azur                   \\\n",
       "clage                   60+ whole                       0-29 30-59  60+ whole   \n",
       "jour                                                                            \n",
       "2021-04-11              NaN   NaN                        NaN   NaN  NaN   NaN   \n",
       "\n",
       "entity     Île-de-France                   \n",
       "clage               0-29 30-59  60+ whole  \n",
       "jour                                       \n",
       "2021-04-11           NaN   NaN  NaN   NaN  \n",
       "\n",
       "[1 rows x 464 columns]"
      ]
     },
     "execution_count": 23,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "columns = pd.MultiIndex.from_tuples([(i, j) for i in dpops.index.unique() for j in dtes.three_class.unique()],\n",
    "                       name = ['entity', 'clage'])\n",
    "index = pd.Index(dhos.jour.unique(), name = \"jour\")\n",
    "dhosps = pd.DataFrame(index = index, columns = columns)\n",
    "dhosps.shape\n",
    "dhosps.sample()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### (1) fill it with data for each (entity = dc.regs, clage)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 24,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>entity</th>\n",
       "      <th>three_class</th>\n",
       "      <th>jour</th>\n",
       "      <th>hosp</th>\n",
       "      <th>rea</th>\n",
       "      <th>dc</th>\n",
       "      <th>dc hebdo</th>\n",
       "      <th>taux hosp</th>\n",
       "      <th>taux rea</th>\n",
       "      <th>taux décès</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>21007</th>\n",
       "      <td>Île-de-France</td>\n",
       "      <td>whole</td>\n",
       "      <td>2020-06-03</td>\n",
       "      <td>5867</td>\n",
       "      <td>540</td>\n",
       "      <td>7182</td>\n",
       "      <td>168.0</td>\n",
       "      <td>47.783838</td>\n",
       "      <td>4.398035</td>\n",
       "      <td>1.368278</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "              entity three_class       jour  hosp  rea    dc  dc hebdo  \\\n",
       "21007  Île-de-France       whole 2020-06-03  5867  540  7182     168.0   \n",
       "\n",
       "       taux hosp  taux rea  taux décès  \n",
       "21007  47.783838  4.398035    1.368278  "
      ]
     },
     "execution_count": 24,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "dhos.sample()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 25,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>entity</th>\n",
       "      <th>three_class</th>\n",
       "      <th>jour</th>\n",
       "      <th>hosp</th>\n",
       "      <th>rea</th>\n",
       "      <th>dc</th>\n",
       "      <th>dc hebdo</th>\n",
       "      <th>taux hosp</th>\n",
       "      <th>taux rea</th>\n",
       "      <th>taux décès</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>jour</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2021-01-07</th>\n",
       "      <td>Grand Est</td>\n",
       "      <td>30-59</td>\n",
       "      <td>2021-01-07</td>\n",
       "      <td>302</td>\n",
       "      <td>55</td>\n",
       "      <td>243</td>\n",
       "      <td>5.0</td>\n",
       "      <td>14.216167</td>\n",
       "      <td>2.589037</td>\n",
       "      <td>0.235367</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "               entity three_class       jour  hosp  rea   dc  dc hebdo  \\\n",
       "jour                                                                     \n",
       "2021-01-07  Grand Est       30-59 2021-01-07   302   55  243       5.0   \n",
       "\n",
       "            taux hosp  taux rea  taux décès  \n",
       "jour                                         \n",
       "2021-01-07  14.216167  2.589037    0.235367  "
      ]
     },
     "execution_count": 25,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "dhos = dhos.set_index(dhos.jour)\n",
    "dhos.sample()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 26,
   "metadata": {},
   "outputs": [],
   "source": [
    "for entity, clage in dhosps.columns:\n",
    "    dhosps.loc[:,(entity,clage)] = dhos[(dhos.entity == entity) & (dhos.three_class == clage)][\"taux hosp\"]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead tr th {\n",
       "        text-align: left;\n",
       "    }\n",
       "\n",
       "    .dataframe thead tr:last-of-type th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr>\n",
       "      <th>entity</th>\n",
       "      <th colspan=\"4\" halign=\"left\">01</th>\n",
       "      <th colspan=\"4\" halign=\"left\">02</th>\n",
       "      <th colspan=\"2\" halign=\"left\">03</th>\n",
       "      <th>...</th>\n",
       "      <th colspan=\"2\" halign=\"left\">Pays de la Loire</th>\n",
       "      <th colspan=\"4\" halign=\"left\">Provence-Alpes-Côte d'Azur</th>\n",
       "      <th colspan=\"4\" halign=\"left\">Île-de-France</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>clage</th>\n",
       "      <th>0-29</th>\n",
       "      <th>30-59</th>\n",
       "      <th>60+</th>\n",
       "      <th>whole</th>\n",
       "      <th>0-29</th>\n",
       "      <th>30-59</th>\n",
       "      <th>60+</th>\n",
       "      <th>whole</th>\n",
       "      <th>0-29</th>\n",
       "      <th>30-59</th>\n",
       "      <th>...</th>\n",
       "      <th>60+</th>\n",
       "      <th>whole</th>\n",
       "      <th>0-29</th>\n",
       "      <th>30-59</th>\n",
       "      <th>60+</th>\n",
       "      <th>whole</th>\n",
       "      <th>0-29</th>\n",
       "      <th>30-59</th>\n",
       "      <th>60+</th>\n",
       "      <th>whole</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>jour</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2020-08-07</th>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>7.375119</td>\n",
       "      <td>2.604032</td>\n",
       "      <td>0.18307</td>\n",
       "      <td>2.304895</td>\n",
       "      <td>23.144019</td>\n",
       "      <td>7.832819</td>\n",
       "      <td>1.502228</td>\n",
       "      <td>9.721645</td>\n",
       "      <td>77.948918</td>\n",
       "      <td>20.703344</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>1 rows × 464 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "entity       01                   02                   03        ...  \\\n",
       "clage      0-29 30-59 60+ whole 0-29 30-59 60+ whole 0-29 30-59  ...   \n",
       "jour                                                             ...   \n",
       "2020-08-07  NaN   NaN NaN   NaN  NaN   NaN NaN   NaN  NaN   NaN  ...   \n",
       "\n",
       "entity     Pays de la Loire           Provence-Alpes-Côte d'Azur            \\\n",
       "clage                   60+     whole                       0-29     30-59   \n",
       "jour                                                                         \n",
       "2020-08-07         7.375119  2.604032                    0.18307  2.304895   \n",
       "\n",
       "entity                          Île-de-France                                  \n",
       "clage             60+     whole          0-29     30-59        60+      whole  \n",
       "jour                                                                           \n",
       "2020-08-07  23.144019  7.832819      1.502228  9.721645  77.948918  20.703344  \n",
       "\n",
       "[1 rows x 464 columns]"
      ]
     },
     "execution_count": 27,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "dhosps.sample()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### (2) fill it with data for each (entity = dc.deps, clage = ['whole'])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>entity</th>\n",
       "      <th>jour</th>\n",
       "      <th>hosp</th>\n",
       "      <th>rea</th>\n",
       "      <th>HospConv</th>\n",
       "      <th>SSR_USLD</th>\n",
       "      <th>autres</th>\n",
       "      <th>rad</th>\n",
       "      <th>dc</th>\n",
       "      <th>dc hebdo</th>\n",
       "      <th>taux hosp</th>\n",
       "      <th>taux rea</th>\n",
       "      <th>taux décès</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>9507</th>\n",
       "      <td>25</td>\n",
       "      <td>2021-03-06</td>\n",
       "      <td>146</td>\n",
       "      <td>44</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>1796</td>\n",
       "      <td>413</td>\n",
       "      <td>10.0</td>\n",
       "      <td>27.064653</td>\n",
       "      <td>8.156471</td>\n",
       "      <td>1.853743</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "     entity       jour  hosp  rea  HospConv  SSR_USLD  autres   rad   dc  \\\n",
       "9507     25 2021-03-06   146   44       NaN       NaN     NaN  1796  413   \n",
       "\n",
       "      dc hebdo  taux hosp  taux rea  taux décès  \n",
       "9507      10.0  27.064653  8.156471    1.853743  "
      ]
     },
     "execution_count": 28,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>entity</th>\n",
       "      <th>jour</th>\n",
       "      <th>hosp</th>\n",
       "      <th>rea</th>\n",
       "      <th>HospConv</th>\n",
       "      <th>SSR_USLD</th>\n",
       "      <th>autres</th>\n",
       "      <th>rad</th>\n",
       "      <th>dc</th>\n",
       "      <th>dc hebdo</th>\n",
       "      <th>taux hosp</th>\n",
       "      <th>taux rea</th>\n",
       "      <th>taux décès</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>jour</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2020-03-25</th>\n",
       "      <td>972</td>\n",
       "      <td>2020-03-25</td>\n",
       "      <td>22</td>\n",
       "      <td>7</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>12</td>\n",
       "      <td>1</td>\n",
       "      <td>0.0</td>\n",
       "      <td>6.132421</td>\n",
       "      <td>1.951225</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "           entity       jour  hosp  rea  HospConv  SSR_USLD  autres  rad  dc  \\\n",
       "jour                                                                           \n",
       "2020-03-25    972 2020-03-25    22    7       NaN       NaN     NaN   12   1   \n",
       "\n",
       "            dc hebdo  taux hosp  taux rea  taux décès  \n",
       "jour                                                   \n",
       "2020-03-25       0.0   6.132421  1.951225         0.0  "
      ]
     },
     "execution_count": 28,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "dhosdep.sample()\n",
    "dhosdep = dhosdep.set_index(dhosdep.jour)\n",
    "dhosdep.sample()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 29,
   "metadata": {},
   "outputs": [],
   "source": [
    "for entity in dhosdep.entity.unique():\n",
    "    for clage in ['whole']:\n",
    "        dhosps.loc[:,(entity, clage)] = dhosdep[(dhosdep.entity == entity)][\"taux hosp\"]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 30,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead tr th {\n",
       "        text-align: left;\n",
       "    }\n",
       "\n",
       "    .dataframe thead tr:last-of-type th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr>\n",
       "      <th>entity</th>\n",
       "      <th colspan=\"4\" halign=\"left\">01</th>\n",
       "      <th colspan=\"4\" halign=\"left\">02</th>\n",
       "      <th colspan=\"2\" halign=\"left\">03</th>\n",
       "      <th>...</th>\n",
       "      <th colspan=\"2\" halign=\"left\">Pays de la Loire</th>\n",
       "      <th colspan=\"4\" halign=\"left\">Provence-Alpes-Côte d'Azur</th>\n",
       "      <th colspan=\"4\" halign=\"left\">Île-de-France</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>clage</th>\n",
       "      <th>0-29</th>\n",
       "      <th>30-59</th>\n",
       "      <th>60+</th>\n",
       "      <th>whole</th>\n",
       "      <th>0-29</th>\n",
       "      <th>30-59</th>\n",
       "      <th>60+</th>\n",
       "      <th>whole</th>\n",
       "      <th>0-29</th>\n",
       "      <th>30-59</th>\n",
       "      <th>...</th>\n",
       "      <th>60+</th>\n",
       "      <th>whole</th>\n",
       "      <th>0-29</th>\n",
       "      <th>30-59</th>\n",
       "      <th>60+</th>\n",
       "      <th>whole</th>\n",
       "      <th>0-29</th>\n",
       "      <th>30-59</th>\n",
       "      <th>60+</th>\n",
       "      <th>whole</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>jour</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2020-04-18</th>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>26.333615</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>51.516016</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>65.226699</td>\n",
       "      <td>20.700737</td>\n",
       "      <td>3.05116</td>\n",
       "      <td>18.020085</td>\n",
       "      <td>94.764478</td>\n",
       "      <td>36.513596</td>\n",
       "      <td>4.819647</td>\n",
       "      <td>59.638166</td>\n",
       "      <td>365.509709</td>\n",
       "      <td>101.724926</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>1 rows × 464 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "entity       01                        02                        03        \\\n",
       "clage      0-29 30-59 60+      whole 0-29 30-59 60+      whole 0-29 30-59   \n",
       "jour                                                                        \n",
       "2020-04-18  NaN   NaN NaN  26.333615  NaN   NaN NaN  51.516016  NaN   NaN   \n",
       "\n",
       "entity      ... Pays de la Loire            Provence-Alpes-Côte d'Azur  \\\n",
       "clage       ...              60+      whole                       0-29   \n",
       "jour        ...                                                          \n",
       "2020-04-18  ...        65.226699  20.700737                    3.05116   \n",
       "\n",
       "entity                                      Île-de-France             \\\n",
       "clage           30-59        60+      whole          0-29      30-59   \n",
       "jour                                                                   \n",
       "2020-04-18  18.020085  94.764478  36.513596      4.819647  59.638166   \n",
       "\n",
       "entity                              \n",
       "clage              60+       whole  \n",
       "jour                                \n",
       "2020-04-18  365.509709  101.724926  \n",
       "\n",
       "[1 rows x 464 columns]"
      ]
     },
     "execution_count": 30,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "dhosps.sample()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 31,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "jour\n",
       "2020-03-18     0.304435\n",
       "2020-03-19     0.304435\n",
       "2020-03-20     0.304435\n",
       "2020-03-21     0.608870\n",
       "2020-03-22     1.217739\n",
       "                ...    \n",
       "2021-04-15    29.682398\n",
       "2021-04-16    29.530181\n",
       "2021-04-17    28.312441\n",
       "2021-04-18    28.312441\n",
       "2021-04-19    28.464659\n",
       "Name: (01, whole), Length: 398, dtype: float64"
      ]
     },
     "execution_count": 31,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "dhosps['01', 'whole']"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 32,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "jour\n",
       "2020-03-18     0.304435\n",
       "2020-03-19     0.304435\n",
       "2020-03-20     0.304435\n",
       "2020-03-21     0.608870\n",
       "2020-03-22     1.217739\n",
       "                ...    \n",
       "2021-04-15    29.682398\n",
       "2021-04-16    29.530181\n",
       "2021-04-17    28.312441\n",
       "2021-04-18    28.312441\n",
       "2021-04-19    28.464659\n",
       "Name: (01, whole), Length: 398, dtype: float64"
      ]
     },
     "execution_count": 32,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "dhosps.loc[:,('01', 'whole')]"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### (3) estimate data for missing (entity = dc.deps, clage = ['0-29', '30-59', '60+'])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "La proportion observée au niveau régional pour la classe d'âge considérée par rapport à l'ensemble de la population est appliquée au taux départemental :\n",
    "Taux (département, classe d'âge) = taux (département) * taux (région, classe d'âge) / taux (région)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 33,
   "metadata": {},
   "outputs": [],
   "source": [
    "for entity in dc.deps:\n",
    "    for clage in ['0-29', '30-59', '60+']:\n",
    "        dhosps.loc[:,(entity, clage)] = (\n",
    "            dhosps.loc[:,(entity, 'whole')]\n",
    "            * dhosps.loc[:,(dc.dep2reg[entity], clage)]\n",
    "            / dhosps.loc[:,(dc.dep2reg[entity], 'whole')]\n",
    "#             * dpops_prop.loc[entity, clage]\n",
    "#             / dpops_prop.loc[dc.dep2reg[entity], clage]\n",
    "        )   "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 34,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "jour\n",
       "2020-03-18    0.141085\n",
       "2020-03-19    0.176356\n",
       "2020-03-20    0.141085\n",
       "2020-03-21    0.246899\n",
       "2020-03-22    0.387984\n",
       "                ...   \n",
       "2021-04-15    2.010461\n",
       "2021-04-16    2.151546\n",
       "2021-04-17    2.116274\n",
       "2021-04-18    2.116274\n",
       "2021-04-19    2.292631\n",
       "Name: (Auvergne-Rhône-Alpes, 0-29), Length: 398, dtype: float64"
      ]
     },
     "execution_count": 34,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "dhosps.loc[:,('Auvergne-Rhône-Alpes', '0-29')]"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Fonction"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 35,
   "metadata": {},
   "outputs": [],
   "source": [
    "def estimate_deps(din, dindep, column):\n",
    "    columns = pd.MultiIndex.from_tuples([(i, j) for i in dtes.entity.unique() for j in dtes.three_class.unique()],\n",
    "                       name = ['entity', 'clage'])\n",
    "    index = pd.Index(din.jour.unique(), name = \"jour\")\n",
    "    dout = pd.DataFrame(index = index, columns = columns)\n",
    "\n",
    "    din = din.copy().set_index(din.jour)\n",
    "    for entity, clage in dout.columns:\n",
    "        dout.loc[:,(entity,clage)] = din[(din.entity == entity) & (din.three_class == clage)][column]\n",
    "\n",
    "    dindep = dindep.copy().set_index(dindep.jour)\n",
    "    for entity in dindep.entity.unique():\n",
    "        for clage in ['whole']:\n",
    "            dout.loc[:,(entity, clage)] = dindep[(dindep.entity == entity)][column]\n",
    "\n",
    "    for entity in dc.deps:\n",
    "        for clage in ['0-29', '30-59', '60+']:\n",
    "            dout.loc[:,(entity, clage)] = (\n",
    "                dout.loc[:,(entity, 'whole')]\n",
    "                * dout.loc[:,(dc.dep2reg[entity], clage)]\n",
    "                / dout.loc[:,(dc.dep2reg[entity], 'whole')]\n",
    "            )\n",
    "    dout = pd.melt(dout.T.reset_index(), id_vars = ['entity', 'clage'], value_name = column)\n",
    "    return dout"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 36,
   "metadata": {},
   "outputs": [],
   "source": [
    "d1 = estimate_deps(dhos, dhosdep, \"taux hosp\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 37,
   "metadata": {},
   "outputs": [],
   "source": [
    "d2 = estimate_deps(dhos, dhosdep, \"taux rea\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 38,
   "metadata": {},
   "outputs": [],
   "source": [
    "d3 = estimate_deps(dhos, dhosdep, \"taux décès\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 39,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "./Temp/v4/vacsi-a-dep-2021-04-19-19h05-estimates-hosp.csv\n"
     ]
    }
   ],
   "source": [
    "dout = pd.merge(pd.merge(d1,d2), d3)\n",
    "fname = path_temp + '-estimates-hosp.csv'\n",
    "dout.to_csv(fname, sep = ';', index = False)\n",
    "print(fname)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 40,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>entity</th>\n",
       "      <th>clage</th>\n",
       "      <th>jour</th>\n",
       "      <th>taux hosp</th>\n",
       "      <th>taux rea</th>\n",
       "      <th>taux décès</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>01</td>\n",
       "      <td>0-29</td>\n",
       "      <td>2020-03-18</td>\n",
       "      <td>0.020058</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>01</td>\n",
       "      <td>30-59</td>\n",
       "      <td>2020-03-18</td>\n",
       "      <td>0.152049</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>01</td>\n",
       "      <td>60+</td>\n",
       "      <td>2020-03-18</td>\n",
       "      <td>0.855067</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>01</td>\n",
       "      <td>whole</td>\n",
       "      <td>2020-03-18</td>\n",
       "      <td>0.304435</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>02</td>\n",
       "      <td>0-29</td>\n",
       "      <td>2020-03-18</td>\n",
       "      <td>1.406754</td>\n",
       "      <td>0.176344</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>184667</th>\n",
       "      <td>Provence-Alpes-Côte d'Azur</td>\n",
       "      <td>whole</td>\n",
       "      <td>2021-04-19</td>\n",
       "      <td>65.214153</td>\n",
       "      <td>11.254733</td>\n",
       "      <td>3.896630</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>184668</th>\n",
       "      <td>Île-de-France</td>\n",
       "      <td>0-29</td>\n",
       "      <td>2021-04-19</td>\n",
       "      <td>4.235447</td>\n",
       "      <td>0.521607</td>\n",
       "      <td>0.062593</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>184669</th>\n",
       "      <td>Île-de-France</td>\n",
       "      <td>30-59</td>\n",
       "      <td>2021-04-19</td>\n",
       "      <td>41.080491</td>\n",
       "      <td>12.579768</td>\n",
       "      <td>0.945999</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>184670</th>\n",
       "      <td>Île-de-France</td>\n",
       "      <td>60+</td>\n",
       "      <td>2021-04-19</td>\n",
       "      <td>233.131628</td>\n",
       "      <td>44.099541</td>\n",
       "      <td>18.235756</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>184671</th>\n",
       "      <td>Île-de-France</td>\n",
       "      <td>whole</td>\n",
       "      <td>2021-04-19</td>\n",
       "      <td>66.866424</td>\n",
       "      <td>14.529805</td>\n",
       "      <td>4.169989</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>184672 rows × 6 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "                            entity  clage       jour   taux hosp   taux rea  \\\n",
       "0                               01   0-29 2020-03-18    0.020058   0.000000   \n",
       "1                               01  30-59 2020-03-18    0.152049   0.000000   \n",
       "2                               01    60+ 2020-03-18    0.855067   0.000000   \n",
       "3                               01  whole 2020-03-18    0.304435   0.000000   \n",
       "4                               02   0-29 2020-03-18    1.406754   0.176344   \n",
       "...                            ...    ...        ...         ...        ...   \n",
       "184667  Provence-Alpes-Côte d'Azur  whole 2021-04-19   65.214153  11.254733   \n",
       "184668               Île-de-France   0-29 2021-04-19    4.235447   0.521607   \n",
       "184669               Île-de-France  30-59 2021-04-19   41.080491  12.579768   \n",
       "184670               Île-de-France    60+ 2021-04-19  233.131628  44.099541   \n",
       "184671               Île-de-France  whole 2021-04-19   66.866424  14.529805   \n",
       "\n",
       "        taux décès  \n",
       "0              NaN  \n",
       "1              NaN  \n",
       "2              NaN  \n",
       "3              NaN  \n",
       "4              NaN  \n",
       "...            ...  \n",
       "184667    3.896630  \n",
       "184668    0.062593  \n",
       "184669    0.945999  \n",
       "184670   18.235756  \n",
       "184671    4.169989  \n",
       "\n",
       "[184672 rows x 6 columns]"
      ]
     },
     "execution_count": 40,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "dout"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
